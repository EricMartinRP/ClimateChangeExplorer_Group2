<html>
<head>
  <title>Choropleth Map with Layers</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }
    .legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      z-index: 999;
      background-color: white;
      padding: 10px;
    }
    .data-switch {
      position: absolute;
      bottom: 10px;
      left: 10px;
      z-index: 999;
      background-color: white;
      padding: 5px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="legend">
    <h3>Data Layers</h3>
    <div class="data-switch">
      <input type="radio" name="dataLayer" value="precipitation" checked /> Precipitation
      <input type="radio" name="dataLayer" value="maxTemperature" /> Max Temperature
      <input type="radio" name="dataLayer" value="minTemperature" /> Min Temperature
      <input type="radio" name="dataLayer" value="windSpeed" /> Wind Speed
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://unpkg.com/choroplethjs@1.0.0/dist/choropleth.js"></script>
  <script>
    $(document).ready(function() {
      var map = L.map('map').setView([37.8, -96], 4);
      // Create the base map
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
      }).addTo(map);
      // Load GeoJSON data for United States
      $.getJSON('https://leafletjs.com/examples/choropleth/us-states.js', function(data) {
        L.geoJSON(data).addTo(map);
      });
      // Read CSV data and update map layers
      $.ajax({
        url: 'Averages.csv',
        dataType: 'text',
        success: function(csvData) {
          var parsedData = processData(csvData);
          updateMapLayers(parsedData);
        }
      });
      // Parse CSV data into an object format
      function processData(csvData) {
        var lines = csvData.split('\n');
        var result = {};
        for (var i = 1; i < lines.length; i++) {
          var data = lines[i].split(',');
          var state = data[0].trim();
          result[state] = {
            precipitation: parseFloat(data[1]),
            maxTemperature: parseFloat(data[2]),
            minTemperature: parseFloat(data[3]),
            windSpeed: parseFloat(data[4])
          };
        }
        return result;
      }
      // Update map layers based on selected dataset
      function updateMapLayers(data) {
        var currentLayer;
        $('input[name="dataLayer"]').change(function() {
          var selectedLayer = $(this).val();
          if (currentLayer) {
            map.removeLayer(currentLayer);
          }
          var layerOptions = {
            valueProperty: selectedLayer,
            scale: ['white', 'blue'],
            steps: 5,
            mode: 'q'
          };
          currentLayer = L.choropleth(data, {
            stateIdField: 'id',
            valueField: selectedLayer,
            legend: {
              position: 'bottomright'
            },
            ...layerOptions
          }).addTo(map);
        });
      }
    });
  </script>
</body>
</html>